<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | Dobux</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/dox/dobux.ico">
    <meta name="description" content="基于 React Context 和 React Hooks 的轻量级数据流管理方案">
    <meta name="theme-color" content="#61dafb">
    
    <link rel="preload" href="/dox/assets/css/0.styles.84d88cfe.css" as="style"><link rel="preload" href="/dox/assets/js/app.71e7d2bd.js" as="script"><link rel="preload" href="/dox/assets/js/2.6f24bad2.js" as="script"><link rel="preload" href="/dox/assets/js/9.36954ae5.js" as="script"><link rel="prefetch" href="/dox/assets/js/10.bebda9f0.js"><link rel="prefetch" href="/dox/assets/js/11.a4d4845b.js"><link rel="prefetch" href="/dox/assets/js/12.76373a60.js"><link rel="prefetch" href="/dox/assets/js/13.6470b2c5.js"><link rel="prefetch" href="/dox/assets/js/14.0eb3479b.js"><link rel="prefetch" href="/dox/assets/js/15.782d6367.js"><link rel="prefetch" href="/dox/assets/js/16.c089d8ac.js"><link rel="prefetch" href="/dox/assets/js/17.e81d33b1.js"><link rel="prefetch" href="/dox/assets/js/18.7db40c24.js"><link rel="prefetch" href="/dox/assets/js/19.3fa9b2f3.js"><link rel="prefetch" href="/dox/assets/js/20.487fd743.js"><link rel="prefetch" href="/dox/assets/js/21.6a4f9d7d.js"><link rel="prefetch" href="/dox/assets/js/3.d2e94c95.js"><link rel="prefetch" href="/dox/assets/js/4.0f1fc6aa.js"><link rel="prefetch" href="/dox/assets/js/5.ccadf297.js"><link rel="prefetch" href="/dox/assets/js/6.2cc0afe6.js"><link rel="prefetch" href="/dox/assets/js/7.0d04ed10.js"><link rel="prefetch" href="/dox/assets/js/8.fd2bd0ae.js">
    <link rel="stylesheet" href="/dox/assets/css/0.styles.84d88cfe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dox/" class="home-link router-link-active"><!----> <span class="site-name">Dobux</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dox/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/dox/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><a href="/dox/api/" class="nav-link">
  API
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dox/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/dox/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><a href="/dox/api/" class="nav-link">
  API
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dox/guide/" aria-current="page" class="active sidebar-link">介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dox/guide/#特性" class="sidebar-link">特性</a></li><li class="sidebar-sub-header"><a href="/dox/guide/#数据流向" class="sidebar-link">数据流向</a></li><li class="sidebar-sub-header"><a href="/dox/guide/#核心概念" class="sidebar-link">核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dox/guide/#store" class="sidebar-link">Store</a></li><li class="sidebar-sub-header"><a href="/dox/guide/#model" class="sidebar-link">Model</a></li></ul></li></ul></li><li><a href="/dox/guide/getting-started.html" class="sidebar-link">快速上手</a></li><li><a href="/dox/guide/best-practice.html" class="sidebar-link">最佳实践</a></li><li><a href="/dox/guide/example.html" class="sidebar-link">例子</a></li><li><a href="/dox/guide/redux-dev-tools.html" class="sidebar-link">DevTools</a></li><li><a href="/dox/guide/eslint.html" class="sidebar-link">Eslint</a></li><li><a href="/dox/guide/faq.html" class="sidebar-link">FAQ</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h1> <p><code>@dobux/store</code>：轻量级的 <strong>响应式</strong> 状态管理方案</p> <h2 id="特性"><a href="#特性" class="header-anchor">#</a> 特性</h2> <ul><li><strong>简单易用</strong>：仅有 3 个核心 API，无需额外的学习成本，只需要了解 <code>React Hooks</code></li> <li><strong>不可变数据源</strong>：通过简单地修改数据与视图进行交互，生成不可变数据源，保证依赖的正确性</li> <li><strong>友好的异步处理</strong>：记录异步操作的加载状态，简化了视图层中的呈现逻辑</li> <li><strong>TypeScript 支持</strong>：完整的 <code>TypeScript</code> 类型定义，在编辑器中能获得完整的类型检查和类型推断</li></ul> <h2 id="数据流向"><a href="#数据流向" class="header-anchor">#</a> 数据流向</h2> <p>数据的改变发生通常是通过用户交互行为触发的，当此类行为会改变数据的时候可以直接调用 <code>Reducers</code> 改变 State ，如果需要执行副作用（比如异步请求）则需要先调用 <code>Effects</code>，执行完副作用后再调用 <code>Reducers</code> 改变 <code>State</code></p> <div style="text-align:center;"><img width="100%" src="/dobux-flow.png"></div> <h2 id="核心概念"><a href="#核心概念" class="header-anchor">#</a> 核心概念</h2> <h3 id="store"><a href="#store" class="header-anchor">#</a> Store</h3> <p>在使用 <code>@dobux/store</code> 的应用中允许创建多个 <code>store</code> 实例，每个 <code>store</code> 实例都会对应一组模型集合，它们之间是相互独立，互不干扰的</p> <p>通常在一个单页应用中会创建一个全局的 <code>store</code> 来存储一些全局的共享状态，与此同时可以针对每一个页面路由乃至每一个组件创建对应的 <code>store</code> 将试图与状态分离进行统一管理</p> <h3 id="model"><a href="#model" class="header-anchor">#</a> Model</h3> <p>每一个 <code>Store</code> 都会包含一个或多个 <code>Model</code>（模型），该 <code>Model</code> 内会存储视图状态 <code>state</code> 以及用于修改它的 <code>reducer</code> 以及 <code>effect</code>，在视图中最终消费的产物就是这个 <code>Model</code>，同一个 <code>Store</code> 中的多个 <code>Model</code> 之间是可以相互调用的</p> <h4 id="state"><a href="#state" class="header-anchor">#</a> State</h4> <p><code>type State = any</code></p> <p><code>State</code> 表示当前模型的状态数据，通常表现为一个 JavaScript 对象（当然它可以是任何值）；操作的时候每次都要当作不可变数据（immutable data）来对待，保证每次都是全新对象，没有引用关系，这样才能保证 <code>State</code> 的独立性以及依赖的正确性</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> Store <span class="token keyword">from</span> <span class="token string">'@dobux/store'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token operator">:</span> <span class="token punctuation">{</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
      count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">useModel</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="reducer"><a href="#reducer" class="header-anchor">#</a> Reducer</h4> <p><code>type Reducer&lt;S, P&gt; = (state: S, ...payload: P) =&gt; void</code></p> <p>在 <code>Dobux</code> 中所有状态数据的改变都必须通过 <code>Reducer</code>，<code>Reducer</code> 函数接受多个参数：第一个参数是当前模型最新的状态数据 <code>state</code>，后面的所有参数都是调用方传入的参数 <code>payload</code></p> <p>在 <code>Reducer</code> 中你可以通过简单地修改数据就能更新状态并刷新组件视图，同时生成不可变数据源，保证依赖的正确性</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dobux/store'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token operator">:</span> <span class="token punctuation">{</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
      count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">increase</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> reducers <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">useModel</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">)</span>

reducers<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>@dobux/store</code> 内置了名为 <code>setValue</code>、<code>setValues</code> 和 <code>reset</code> 的 <code>Reducer</code>，可以简化状态修改逻辑</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// modify specify state</span>
reducers<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">// batch modify specify state</span>
reducers<span class="token punctuation">.</span><span class="token function">setValues</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// reset total state</span>
reducers<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// reset partial state</span>
reducers<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="effect"><a href="#effect" class="header-anchor">#</a> Effect</h4> <p><code>type Effect&lt;P&gt; = (...payload: P) =&gt; Promise&lt;void&gt;</code></p> <p><code>Effect</code> 被称为副作用，在我们的应用中，最常见的就是异步操作。它来自于函数编程的概念，之所以叫副作用是因为它使得我们的函数变得不纯，同样的输入不一定获得同样的输出</p> <p>在 <code>@dobux/store</code> 中所有副作用处理通过调用 <code>Effect</code> 进行，通常会在副作用中处理异步请求以及调用其他模型进行通信</p> <p><code>@dobux/store</code> 内置了异步操作 <code>loading</code> 态处理，可以简化视图逻辑处理</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token operator">:</span> <span class="token punctuation">{</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
      count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">increase</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">effects</span><span class="token operator">:</span> <span class="token punctuation">(</span>store<span class="token punctuation">,</span> Models<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">async</span> <span class="token function">increaseAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
        store<span class="token punctuation">.</span>reducers<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> effects <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">useModel</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">)</span>

effects<span class="token punctuation">.</span><span class="token function">increaseAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>effects<span class="token punctuation">.</span>increaseAsync<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>loading <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020-11-12 12:01:23 ├F10: PM┤</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/dox/guide/getting-started.html">
        快速上手
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/dox/assets/js/app.71e7d2bd.js" defer></script><script src="/dox/assets/js/2.6f24bad2.js" defer></script><script src="/dox/assets/js/9.36954ae5.js" defer></script>
  </body>
</html>
